<mat-card class="mat-elevation-z4">
  <mat-card-title>
    <mat-icon style="vertical-align: middle; margin-right: 6px;">warning</mat-icon>
    Produtos com Estoque Baixo
  </mat-card-title>

  <!-- Filtro para selecionar o limite de estoque -->
  <mat-form-field appearance="fill" class="custom-select">
    <mat-label>Limite de Estoque</mat-label>
    <mat-select [(ngModel)]="limite" (selectionChange)="carregarProdutosEstoqueBaixo()">
      <mat-option value="5">5</mat-option>
      <mat-option value="10">10</mat-option>
      <mat-option value="25">25</mat-option>
      <mat-option value="50">50</mat-option>
      <mat-option value="100">100</mat-option>
    </mat-select>
  </mat-form-field>

  <div class="scrollable-form">
    <!-- Tabela com suporte à ordenação via matSort -->
    <table mat-table [dataSource]="produtos" class="mat-table" matSort>
      <!-- ID -->
      <ng-container matColumnDef="proId">
        <!-- O mat-sort-header habilita a ordenação clicável para a coluna ID -->
        <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
        <td mat-cell *matCellDef="let produto">{{ produto.proId }}</td>
      </ng-container>

      <!-- Nome -->
      <ng-container matColumnDef="proNome">
        <!-- O mat-sort-header habilita a ordenação clicável para a coluna Nome -->
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Nome</th>
        <td mat-cell *matCellDef="let produto">{{ produto.proNome }}</td>
      </ng-container>

      <!-- Quantidade em Estoque -->
      <ng-container matColumnDef="proQuantidadeEstoque">
        <!-- O mat-sort-header habilita a ordenação clicável para a coluna Estoque -->
        <!-- Como definido no componente TypeScript, esta coluna é ordenada em ordem crescente por padrão -->
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Estoque</th>
        <td mat-cell *matCellDef="let produto" [ngClass]="{'estoque-critico': produto.proQuantidadeEstoque < 3}">
          {{ produto.proQuantidadeEstoque }}
        </td>
      </ng-container>

      <!-- Categoria -->
      <ng-container matColumnDef="proCategoria">
        <!-- O mat-sort-header habilita a ordenação clicável para a coluna Categoria -->
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Categoria</th>
        <td mat-cell *matCellDef="let produto">{{ produto.proCategoria }}</td>
      </ng-container>

      <!-- Marca -->
      <ng-container matColumnDef="proMarca">
        <!-- O mat-sort-header habilita a ordenação clicável para a coluna Marca -->
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Marca</th>
        <td mat-cell *matCellDef="let produto">{{ produto.proMarca }}</td>
      </ng-container>

      <!-- Fornecedor -->
      <ng-container matColumnDef="fornecedor">
        <!-- O mat-sort-header habilita a ordenação clicável para a coluna Fornecedor -->
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Fornecedor</th>
        <td mat-cell *matCellDef="let produto">{{ produto.fornecedor?.forNomeFantasia || 'N/A' }}</td>
      </ng-container>

      <!-- Ações -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Ações</th>
        <td mat-cell *matCellDef="let produto">
          <a [routerLink]="['/products/update', produto.proId]" class="edit">
            <i class="material-icons">edit</i>
          </a>
        </td>
      </ng-container>

      <!-- Cabeçalho e linhas -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <!-- Mensagem para tabela vazia -->
      <tr class="mat-row" *ngIf="produtos.data.length === 0">
        <td class="mat-cell" colspan="7">Nenhum produto com estoque baixo encontrado.</td>
      </tr>
    </table>
  </div>
</mat-card>